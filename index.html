<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <title>Software_guide Vayu-2G</title>
  

  <link rel="shortcut icon" href="./img/favicon.ico">

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="./css/theme.css" type="text/css" />
  <link rel="stylesheet" href="./css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="./css/highlight.css">

  
  <script>
    // Current page data
    var mkdocs_page_name = "None";
    var mkdocs_page_input_path = "index.md";
    var mkdocs_page_url = "/";
  </script>
  
  <script src="./js/jquery-2.1.1.min.js"></script>
  <script src="./js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="./js/highlight.pack.js"></script>
  <script src="./js/theme.js"></script> 

  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="." class="icon icon-home"> Software_guide Vayu-2G</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="./search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        <ul class="current">
          
            <li>
    <li class="toctree-l1 current">
        <a class="current" href=".">Home</a>
        
            <ul>
            
                <li class="toctree-l3"><a href="#sw-startup-guide-for-vayu-2g">SW startup guide for Vayu 2G</a></li>
                
                    <li><a class="toctree-l4" href="#software-overview-for-using-vayu-2g-avayu-2gp-a-cape">Software overview for using Vayu-2G-A/Vayu-2GP-A Cape</a></li>
                
                    <li><a class="toctree-l4" href="#device-enable-for-vayu-2g-avayu-2gp-a-cape">Device enable for Vayu-2G-A/Vayu-2GP-A Cape</a></li>
                
                    <li><a class="toctree-l4" href="#wvdial-configuration-for-debian-wheezy">Wvdial Configuration for Debian Wheezy</a></li>
                
                    <li><a class="toctree-l4" href="#faq">FAQ</a></li>
                
            
            </ul>
        
    </li>
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href=".">Software_guide Vayu-2G</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".">Docs</a> &raquo;</li>
    
      
    
    <li>Home</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="sw-startup-guide-for-vayu-2g">SW startup guide for Vayu 2G</h1>
<p>For a quick guide to starting with the Vayu 2G cape's HW, see 
<a href="http://www.yantrr.com/w/images/4/4b/Leaflet_for_Vayu_2GP_Cape.pdf">Leaflet for 2G cape.</a></p>
<p>Below, we describe how to set up the 2G capes and its associated software. </p>
<h2 id="software-overview-for-using-vayu-2g-avayu-2gp-a-cape">Software overview for using Vayu-2G-A/Vayu-2GP-A Cape</h2>
<p>Data connection is established based on PPP protocols. Wvdial is mainly used to configure the dialup settings. For setting up various settings for PPP connection and establishing a data connection on these capes follow the link to the wiki</p>
<ul>
<li>
<p>Way to setup the Vayu 2G Capes</p>
</li>
<li>
<p>How to read location and coarse time as NMEA-0183 message from the serial UART ttyO4 port</p>
</li>
<li>
<p>How to write wvdial conf files for any network</p>
</li>
<li>
<p>Sample wvdial.conf file for 
<a href="http://www.yantrr.com/wiki/Sample_wvdial.conf_file#Sample_Wvdial_conf_file_for_AT.26T_3G">AT&amp;T</a> 
and 
<a href="http://www.yantrr.com/wiki/Sample_wvdial.conf_file#Sample_Wvdial_conf_file_for_TMOBILE_2G">T-Mobile USA</a></p>
</li>
</ul>
<p>For using the Vayu-2G-A/Vayu-2GP-A Cape, please ensure that you have the following :</p>
<ol>
<li>
<p>PPS drivers enabled in kernel, required if GPS module is present.</p>
</li>
<li>
<p>Vayu Device tree overlay file</p>
</li>
</ol>
<p>You can either download kernel patches containing the same to use with your existing images or you can download our prebuilt MicroSD card image or EMMC flasher image.</p>
<p>All the images and files and extra support on software can be found here :
<a href="http://www.yantrr.com/wiki/Vayu_Cape_SW_images_and_drivers">Vayu_Cape_SW_images_and_drivers</a></p>
<h2 id="device-enable-for-vayu-2g-avayu-2gp-a-cape">Device enable for Vayu-2G-A/Vayu-2GP-A Cape</h2>
<p><span style="color:black;font-size:1.5em;">Setting up the system</span></p>
<ol>
<li>
<p>Place a mini sim in the sim card slot and connect a GSM antenna to the SMA connector.</p>
</li>
<li>
<p>Mount the cape on BBB carefully.</p>
</li>
<li>
<p>Ensuring that the power jumper on the cape is in its place, power up the setup using a 5V DC adapter(min 2.5A) to barrel jack. D2 LED on the cape will glow alongwith LEDs on the Beaglebone black.</p>
</li>
</ol>
<p><code>Note</code>: Before proceeding further ensure D2 LED is glowing properly. Make sure that the adapter being used is of proper rating and has been connected properly. Further check for the presence of the power jumper(#12 on leaflet).</p>
<p><code>Note</code>: Do not try to power up using USB cable alone. Always power up system with a DC adapter. Also while disconnecting power, USB cable should be removed before the DC adapter.</p>
<p><span style="color:black;font-size:1.2em;">GSM/GPRS Modem</span></p>
<p><code>Note</code>: All commands are executed as root on Debian unless otherwise mentioned.</p>
<p>GSM/GPRS Modem is connected to Beaglebone Black at UART1 port. To access the Modem from Beaglebone Black, we need to first enable the UART1 (ttyO1) port in kernel. For this do following :</p>
<p><code>Step 1.</code> Boot into Beaglebone Black , running Debian Wheezy on it. Login as root user</p>
<p><code>Step 2.</code> Go to /lib/firmware</p>
<pre><code>    cd /lib/firmware
</code></pre>
<p><code>Step 3.</code> After ensuring that file BB-UART1-00A0.dtbo exists, apply the device tree overlay as :</p>
<pre><code>    echo BB-UART1 &gt; /sys/devices/bone_capemgr.9/slots
</code></pre>
<p><code>Step 4.</code> On reading ‘’’slots’’’ if you are able to see UART1 , then it has been applied successfully.</p>
<pre><code>    cat /sys/devices/bone_capemgr.9/slots
</code></pre>
<p><code>Step 5.</code> You can verify that UART1 (ttyO1 ) by checking for ttyO1 in devices (/dev/)</p>
<pre><code>    ls /dev/ttyO*
</code></pre>
<p>Output will show /dev/ttyO0 and /dev/ttyO1 .</p>
<p>Over UART1 port we can communicate with the modem and also AT commands can be executed whenever required. The UART port of modem is available at one instant only, either it is establishing ppp connection or AT commands are executed on it. We now see and understand different modes for controlling the GPS/GPRS Modem and ensure that it is properly powered on and available for establishing data connection. </p>
<p>The Modem has different operating modes:</p>
<p><img alt="Modes" src="./img/modes.png" /></p>
<p><span style="color:black;font-size:1em;">To use the modem after powering up the Cape, it needs to be properly turned on.</span></p>
<p>For the Modem , there is a ON/OFF pin and a Reset pin which are used to turn the modem on/off or soft reset and hard reset it. Now, on the Vayu Cape, there are two Leds which indicate status of 2G module :</p>
<p>i. <strong>STATUS LED D3 </strong>: This Led gives the state of the Modem. It is on when the module is turned on and off when it is turned off.</p>
<p>ii. <strong>NETLIGHT LED D4</strong> : It has different states depending on the mode of operation of the Modem :-</p>
<p>a. Off when Modem is off</p>
<p>b. 64ms ON/800ms OFF when Modem is on but it is not registered on a network i.e. sim card has not been detected or is not present</p>
<p>c. 64ms ON/3000ms OFF when Modem is on and is registered to a network i.e. sim card has been detected but a network connection has not been established.</p>
<p>d. 64ms ON/300ms OFF when Modem is on and GPRS communication has been established.</p>
<p>On the Cape, ON/OFF pin and Reset pin can be controlled via a push button switch as well as GPIOs assigned to them on Beaglebone Black. For ON/OFF pin, S1 is the ON/OFF push button switch provided on cape and GPIO45 in Beaglebone Black is assigned the same. <strong>GPIO45 should always be set high. </strong>For Reset pin, S2 is the Hard Reset push button switch provided on cape and GPIO60 in Beaglebone Black is assigned the same. <strong>GPIO60 should always be set high.</strong></p>
<p><strong>To Power on Modem :</strong></p>
<p>User can Power on or off the modem by hardware push button or by software method (prefered)</p>
<ul>
<li>
<p>By pressing the switch S1 for atleast 1s and then releasing it after Beaglebone Black is booted properly</p>
</li>
<li>
<p>By setting GPIO45 ‘Active Low’ for atleast 1s and then setting it ‘Active high’. </p>
</li>
</ul>
<p>Also, when Cape and Beaglebone black, both are powered up and booted, GPIO45 is initially set low internally.</p>
<p><code>Step 6</code>: Set GPIO45 High, after Beaglebone Black has booted completely with Vayu Cape mounted on it to turn on the modem properly.</p>
<p><code>Step 7</code>: Once ttyO1 port was enabled, you can execute AT commands for the modem on it or see the messages from the modem that are sent there. You can use minicom for it.</p>
<pre><code>    apt-get install minicom

    minicom –s
</code></pre>
<p>and set serial port settings as /dev/ttyO1 115200 8N1 When you , properly turn on the modem after you have booted i.e. set GPIO45 high, or whenever modem is turned ON , you will see an output on /dev/ttyO1 port. RDY Power On of Modem is indicated by the STATUS GPIO or LED which should be ON . Also the NETLIGHT LED will start blinking depending on whether SIM Card is present or not. </p>
<p><strong>To power off Modem :</strong></p>
<p>Modem can be powered off by :</p>
<p>1) Normal power down procedure :</p>
<ul>
<li>Power down by ON/OFF Pin : </li>
</ul>
<p>i. Press the switch S1 for atleast 1s and then release it</p>
<p>ii. Set GPIO45 low for atleast 1s and set it high</p>
<ul>
<li>Power down by AT command : AT+CPOWD=1 , at /dev/ttyO1</li>
</ul>
<p>2) Abnormal Power down procedure :</p>
<ul>
<li>
<p>Over-voltage or under-voltage automatic power down</p>
</li>
<li>
<p>over-temperature or under-temperature automatic power down</p>
</li>
</ul>
<p>In Normal Power down, the modem port /dev/ttyO1 will read out the following message :</p>
<pre><code>   NORMAL POWER DOWN
</code></pre>
<p>In Abnormal Power down Procedure , AT commands cannot be issued anymore, only RTC is active.</p>
<p>Following URC will be reported :</p>
<p>If voltage &lt;= 3.3V, UNDER-VOLTAGE WARNING</p>
<p>If voltage &gt;= 4.7V, OVER-VOLTAGE WARNING</p>
<p>If voltage &lt; 3.2V, UNDER-VOLTAGE POWERDOWN</p>
<p>If voltage &gt; 4.8V, OVER-VOLTAGE POWERDOWN</p>
<p>If temperature &gt; 80degree Celsius , +CMTE:1</p>
<p>If temperature &lt; -30degree Celsius , +CMTE:-1</p>
<p>If temperature &gt; +85degree Celsius, +CMTE:2</p>
<p>If temperature &lt; -40degree Celsius, _CMTE:-2</p>
<p><strong>Power down of Modem is indicated by STATUS LED not glowing or GPIO going low. Also, NETLIGHT LED will be Off.</strong></p>
<p><strong>Soft Reset the Modem :</strong></p>
<ol>
<li>
<p>Power Down the Module</p>
</li>
<li>
<p>Wait for atleast 800ms after STATUS LED switched off or GPIO went low</p>
</li>
<li>
<p>Power On the Module </p>
</li>
</ol>
<p><strong>Hard Reset the Modem:</strong></p>
<p>This is an emergency reset only.Use this only when ON/OFF pin or “AT+CPOWD=1” have no effect.</p>
<ol>
<li>
<p>The Hard reset pin can be pulled low for atleast 1.2s and then set high.</p>
</li>
<li>
<p>GPIO60 should be high all the time. S2 is Hard reset push button switch for Modem.</p>
</li>
</ol>
<p><code>Note :</code> The GPRS modem on the cape has been shipped pre-set with settings so that its serial port is working and appropriate settings has been stored in the modem. For more details about its operation modes refer to datasheet.</p>
<p>If SIM900A has been set to minimum functionality by “AT+CFUN=0”, the RF function and SIM card function will be closed. In this case, the serial port is still accessible, but all AT commands correlative with RF function or SIM card function will not be accessible. For SIM900A, it requests to set AT command “AT+CSCLK=1” to enable the sleep mode; the default value is 0, that can’t make the module enter sleep mode</p>
<p>To change the modes or any settings related to modem , you need access to AT ports and run AT commands there.</p>
<p>Considering that, Cape is connected properly to Beaglebone black and user is logged in as root and has checked for UART1 port, we check that the Modem is turned on properly before trying to establish a connection, so:</p>
<p>i. D3 is continuously glowing and D4 is blinking as 64ms ON/800ms OFF, when SIM card is not present or not detected/inserted properly.</p>
<p>ii. D3 is continuously glowing and D4 is blinking as 64ms ON/3000 ms OFF when a valid SIM card is present. If SIM card was inserted while the modem was on, please software reset the modem by turning it OFF and then ON again using Software GPIO commands or Push button switch. [refer to]</p>
<p>If any other state of LEDs is present, please soft reset the modem using push button switch or GPIOs.</p>
<p>So when it is established that modem is in ii  state , now we try to establish connection</p>
<p>Summarizing, following are the steps to enable PPP connection using the Modem :</p>
<p><code>Step 1 :</code> Ensure that a GSM/GPRS enabled SIM card is placed in the simcard slot, before Beaglebone black is booted up with the cape.</p>
<p><code>Step 2 :</code>Enable UART1(/dev/ttyO1 ) in the kernel by applying its device tree overlay from /lib/firmware directory.</p>
<p><code>Step 3:</code> Check for the status of the LEDs, D3(STATUS) and D4(NETLIGHT). D3 should be high and D4 should be blinking. If no sim card is present, and D4 blinks accordingly, then insert the sim card in the slot and Soft Reset the Modem.</p>
<p><code>Step 4 :</code> Now we have to ensure that the modem is properly switched on. The GPIO45 is pulled low in Beaglebone black when it has booted , but ON/OFF Pin in modem also has internal pullup so basically it is turned on when the Board boots up. But to be safe, we have to set the GPIO45 high.</p>
<p>When you turn GPIO45 high, check once again that setting the ON/OFF pin high, completed the Power ON cycle for the modem and not the Power OFF cycle, by checking the STATUS LED which should still be ON.</p>
<p><code>Step 5:</code> Once it has been ensured modem is properly switched on, we can proceed with establishing PPP connection either using PPPd or Wvdial. For more details on using them, please refer to Application notes for 2G/2GP cape. </p>
<p>All the images and files and extra support on software can be found here :
<a href="http://www.yantrr.com/products/m2m-cape-for-beaglebone/support/">click here</a> </p>
<h2 id="wvdial-configuration-for-debian-wheezy">Wvdial Configuration for Debian Wheezy</h2>
<p><code>Note :</code> All commands are recommended to be executed as root user.</p>
<p>Download and install Wvdial</p>
<pre><code>    $ apt-get install wvdial
</code></pre>
<p>Executing the following command usually sets the wvdial.conf file which is used for dialing to GPRS communication, but since here our modem port is on a UART(/dev/ttyO1) and not on /dev/ttyS<em> or /dev/ttyUSB</em> ports, we will have to manually configure it.</p>
<pre><code>    $ wvdialconf
</code></pre>
<p>So, open the wvdial.conf file</p>
<pre><code>    $ nano /etc/wvdial.conf
</code></pre>
<p>Considering that, you have the USERNAME, PASSWORD and APN available for the service provider of the sim card being used, edit and make wvdial.conf file like this.</p>
<pre><code>    [Dialer Defaults]
    Modem Type = Analog
    ModemPhone = *99#
    ISDN = 0
    Baud = 115200
    Username = USERNAME
    Password = PASSWORD
    Modem = /dev/ttyO1
    Init1 = ATZ
    Init2 = at+cgdcont=1,"ip","APN"
    Stupid Mode = 1
</code></pre>
<p>Usually for GSM Networks, Modemphone is <em>99# or </em>99***1# After editing save and exit, now run wvdial for establishing communication.</p>
<pre><code>    $ wvdial
</code></pre>
<p>You can also edit the wvdial.conf file for multiple service providers by providing its name here [Dialer Defaults] : </p>
<pre><code>    [Dialer Vodafone]
    Modem Type = Analog Modem
    Phone = *99#
    ISDN = 0
    Baud = 115200
    Username = 0
    Password = 0
    Modem = /dev/ttyO1
    Init1 = ATZ
    Init2 = at+cgdcont=1,"ip","www"
    Stupid Mode = 1
    [Dialer Airtel]
    Modem Type = Analog Modem
    Phone = *99#
    ISDN = 0
    Baud = 115200
    Username = airtel
    Password = airtel
    Modem = /dev/ttyO1
    Init1 = ATZ
    Init2 = at+cgdcont=1,"ip","airtelgprs.com"
    Stupid Mode = 1
</code></pre>
<p>And run wvdial for the required service provider as follows:</p>
<pre><code>    wvdial airtel
</code></pre>
<p>A list of running commands should be visible on the shell, trying to establish PPP connection. Once PPP connection has been established, you will see a ppp0 IP. To check the status of wvdial and find out its IP open a new shell and use either of following:</p>
<p>Run ifconfig and find ppp0 in the list of network connections.</p>
<pre><code>    $ ifconfig
</code></pre>
<p>or</p>
<pre><code>    $ ifconfig ppp0
</code></pre>
<p>Check the network statistics for IP and their gateways and check the Iface column for ppp0</p>
<pre><code>    $ netstat -arn
    * Kernel IP routing table

    Destination Gateway Genmask Flags MSS Window irtt Iface
    0.0.0.0 192.168.1.1 0.0.0.0 UG 0 0 0 eth0
    192.168.1.0 0.0.0.0 255.255.255.0 U 0 0 0 eth0
    192.168.7.0 0.0.0.0 255.255.255.252 U 0 0 0 usb0
    192.200.1.21 0.0.0.0 255.255.255.255 UH 0 0 0 ppp0
</code></pre>
<ol>
<li>Read the system messages as<pre><code>$ cat /var/log/messages
</code></pre>
</li>
</ol>
<p>It lists all the attempts at establishing ppp communication using the modem and ips for the successful attempt. Now all that is left, is to route the network traffic over the gateway of ppp0 instead of eth0 so that GPRS communication is fully completed.</p>
<p>PPP connection has been established over GPRS using 2G module and wvdial.</p>
<p>After PPP has been established, the following is the status of the LEDs and GPIOs</p>
<ol>
<li>
<p>STATUS LED D3 – It is continuously glowing, once the Modem was turned on.</p>
</li>
<li>
<p>SIGNAL LED D4 – It is now blinking at 64ms ON/300ms OFF . Earlier when PPP was not established but SIMcard was detected by modem, then it was blinking at 64ms ON/3000ms OFF.</p>
</li>
<li>
<p>STATUS GPIO23 – Its value is be 1, once modem was turned on.</p>
</li>
<li>
<p>ON/OFF GPIO45 – Its value should be 1.</p>
</li>
<li>
<p>RESET GPIO60 – Its value should always be 1.</p>
</li>
</ol>
<p>You can alternately run wvdial for multiple service providers and store their wvdial.conf files too by this way also</p>
<pre><code>    $ wvdial -C /etc/wvdial.conf.provider_name
</code></pre>
<p>where wvdial.conf.provider_name is wvdial.conf for the SIM card currently inserted. Also, you can Wvdial in background to free up the shell instead of opening another new shell by :</p>
<pre><code>    $ wvdial &amp; disown
</code></pre>
<p><br></p>
<h2 id="faq">FAQ</h2>
<p><strong>Ques) How do I check that whether the PPP connection has been established or not?</strong></p>
<p><strong>Ans)</strong></p>
<p>1) Use the command “ifconfig ppp0” to check the network information. If a connection is established, an IP should be visible.</p>
<p>2) Details about the connection can be found in “/var/log/messages”. Issue following command :</p>
<p>“tail –f /var/log/messages”</p>
<p><strong>Ques) How do I configure the ppp connection for my sim card operator?</strong></p>
<p><strong>Ans)</strong> You would mainly require the Username, Password and APN of the service provider to establish a PPP connection. Ensure “wvdial” package is installed.</p>
<pre><code>    “dpkg –l | grep wvdial”
</code></pre>
<p>If wvdial is present, issue “wvdialconf” command. Then update the service provider information in the "/etc/wvdial.conf" file and you are good to go. </p>
              
            </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>

  </div>

<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
      
    </span>
</div>

</body>
</html>

<!--
MkDocs version : 0.15.3
Build Date UTC : 2016-07-19 14:05:07.115897
-->
